<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommended Meals</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    
</head>
<body>

  <div class="container">

    <h2>BMI Calculator</h2>
    {% for items in meals[3] %}
        <h4>Your BMI is: {{items.bmi}} kg/m²</h4>
        <p>Your BMI is in the 
          {{items.category}}
           weight Category</p>
    {% endfor %}
    <p> 
      Note:<b> Healthy BMI range: 18.5 kg/m² - 25 kg/m².</b>
    </p>

    <hr>

    <h2>Calories Calculator</h2>
    {% for items in meals[4] %}
        <h4>Your BMR is: {{items.bmr}}</h4>
        <p id = "daily_caloric_need">Your Daily Caloric need is: {{items.daily_caloric_need}} kcal</p>
        <p id = "weight_loss_plan">Your Selected Weight loss plan is: {{items.weight_loss_plan}}</p>
        <p id = "adjust_according_to_plan">Note: <b> Your Daily Caloric need according to your weight loss plan is: {{items.adjust_according_to_plan}} Kcal</b></p>
    {% endfor %}
    
    <hr>

      
    <h2>Recommended Meals</h2>
    <p class="d-inline-flex gap-1">
        <a class="btn btn-outline-primary" data-bs-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
          Breakfast Recommendations
        </a>
      </p>

      <div class="collapse" id="collapseExample">

        <div class="row row-cols-1 row-cols-md-5 g-4">
            {% for meal in meals[0] %}
            <div class="col">
                <div class="card text-md-light h-100">
                  <img src="{{meal.Images[0]}}" class="card-img-top" alt="...">
                  <div class="card-body">
                    <h5 class="card-title">{{ meal.Name }}</h5>
                    
                    <div class="card-header">
                        Nutritional values
                      </div>
                      <ul class="list-group list-group-flush">
                        <li class="list-group-item" id = "breakfast_cal">Calories: {{meal.Calories}}</li>
                        <li class="list-group-item">SaturatedFats: {{meal.SaturatedFatContent}}</li>
                        <li class="list-group-item">Fats: {{meal.FatContent}}</li>
                        <li class="list-group-item">Carbohydrates: {{meal.CarbohydrateContent}}</li>
                        <li class="list-group-item">Cholesterol: {{meal.CholesterolContent}}</li>
                        <li class="list-group-item">Sodium: {{meal.SodiumContent}}</li>
                        <li class="list-group-item">Fiber: {{meal.FiberContent}}</li>
                        <li class="list-group-item">Sugar: {{meal.SugarContent}}</li>
                        <li class="list-group-item">Protein: {{meal.ProteinContent}}</li>
                      </ul>
                    
                      <p class="card-text">
                        Cooking and Prep time:
                        <ul>
                            <li>{{meal.TotalTime}}</li>
                            <li>{{meal.CookTime}}</li>
                            <li>{{meal.PrepTime}}</li>
                        </ul>
                      </p>
                      
                        <p class="card-text">
                            Recipe Ingredients:
                            <ul>
                                {% for ings in meal.RecipeIngredientParts %} 
                                    <li>{{ings}}</li>
                                {% endfor %}
                            </ul>
                          </p>

                          <p class="card-text"><small class="text-body-secondary">
                            Instructions
                            <ul>
                              {% for instrs in meal.RecipeInstructions %}  
                                  <li>{{instrs}}</li> 
                              {% endfor %} 
                          </ul>
                            </small>
                          </p>
                       
                  </div>
                </div>
              </div>    
            {% endfor %}
        </div>

      </div> 

      <br>

      <p class="d-inline-flex gap-1">
        <a class="btn btn-outline-primary" data-bs-toggle="collapse" href="#collapseExample2" role="button" aria-expanded="false" aria-controls="collapseExample2">
          Lunch Recommendations
        </a>
      </p>

      <div class="collapse" id="collapseExample2">

        <div class="row row-cols-1 row-cols-md-5 g-4">
            {% for meal in meals[1] %}
            <div class="col">
                <div class="card text-md-light h-100">
                  <img src="{{meal.Images[0]}}" class="card-img-top" alt="...">
                  <div class="card-body">
                    <h5 class="card-title">{{ meal.Name }}</h5>
                    
                    <div class="card-header">
                        Nutritional values
                      </div>
                      <ul class="list-group list-group-flush">
                        <li class="list-group-item" id = "lunch_cal">Calories: {{meal.Calories}}</li>
                        <li class="list-group-item">SaturatedFats: {{meal.SaturatedFatContent}}</li>
                        <li class="list-group-item">Fats: {{meal.FatContent}}</li>
                        <li class="list-group-item">Carbohydrates: {{meal.CarbohydrateContent}}</li>
                        <li class="list-group-item">Cholesterol: {{meal.CholesterolContent}}</li>
                        <li class="list-group-item">Sodium: {{meal.SodiumContent}}</li>
                        <li class="list-group-item">Fiber: {{meal.FiberContent}}</li>
                        <li class="list-group-item">Sugar: {{meal.SugarContent}}</li>
                        <li class="list-group-item">Protein: {{meal.ProteinContent}}</li>
                      </ul>
                    
                      <p class="card-text">
                        Cooking and Prep time:
                        <ul>
                            <li>{{meal.TotalTime}}</li>
                            <li>{{meal.CookTime}}</li>
                            <li>{{meal.PrepTime}}</li>
                        </ul>
                      </p>
                      
                        <p class="card-text">
                            Recipe Ingredients:
                            <ul>
                                {% for ings in meal.RecipeIngredientParts %} 
                                    <li>{{ings}}</li>
                                {% endfor %}
                            </ul>
                          </p>

                          <p class="card-text"><small class="text-body-secondary">
                            Instructions
                            <ul>
                              {% for instrs in meal.RecipeInstructions %}  
                                  <li>{{instrs}}</li> 
                              {% endfor %} 
                          </ul>
                            </small>
                          </p>
                       
                  </div>
                </div>
              </div>    
            {% endfor %}
        </div>

      </div>

      <br>


      <p class="d-inline-flex gap-1">
        <a class="btn btn-outline-primary" data-bs-toggle="collapse" href="#collapseExample3" role="button" aria-expanded="false" aria-controls="collapseExample3">
          Dinner Recommendations
        </a>
      </p>

      <div class="collapse" id="collapseExample3">

            <div class="row row-cols-1 row-cols-md-5 g-4">
                {% for meal in meals[2] %}
                <div class="col">
                    <div class="card text-md-light h-100">
                      <img src="{{meal.Images[0]}}" class="card-img-top" alt="Not found..">
                      <div class="card-body">
                        <h5 class="card-title">{{ meal.Name }}</h5>
                        
                        <div class="card-header">
                            Nutritional values
                          </div>
                          <ul class="list-group list-group-flush">
                            <li class="list-group-item" id = "lunch_cal">Calories: {{meal.Calories}}</li>
                            <li class="list-group-item">SaturatedFats: {{meal.SaturatedFatContent}}</li>
                            <li class="list-group-item">Fats: {{meal.FatContent}}</li>
                            <li class="list-group-item">Carbohydrates: {{meal.CarbohydrateContent}}</li>
                            <li class="list-group-item">Cholesterol: {{meal.CholesterolContent}}</li>
                            <li class="list-group-item">Sodium: {{meal.SodiumContent}}</li>
                            <li class="list-group-item">Fiber: {{meal.FiberContent}}</li>
                            <li class="list-group-item">Sugar: {{meal.SugarContent}}</li>
                            <li class="list-group-item">Protein: {{meal.ProteinContent}}</li>
                          </ul>
                        
                          <p class="card-text">
                            Cooking and Prep time:
                            <ul>
                                <li>{{meal.TotalTime}}</li>
                                <li>{{meal.CookTime}}</li>
                                <li>{{meal.PrepTime}}</li>
                            </ul>
                          </p>
                          
                            <p class="card-text">
                                Recipe Ingredients:
                                <ul>
                                    {% for ings in meal.RecipeIngredientParts %}  
                                        <li>{{ings}}</li> 
                                     {% endfor %}
                                </ul>
                              </p>
                        <p class="card-text"><small class="text-body-secondary">
                          Instructions
                          <ul>
                            {% for instrs in meal.RecipeInstructions %}  
                                <li>{{instrs}}</li> 
                            {% endfor %} 
                        </ul>
                          </small></p>
                      </div>
                    </div>
                  </div>    
                {% endfor %}
            </div>

      </div>

    <br>

    <a href="/user_info">Back</a>

    <hr>

    <h2>Choose your meal composition: </h2>
    
    <div class="container">
      <div class="row">
        <div class="col">

          <h4>Select Breakfast: </h4>
            <select class = "form-select" id="select_breakfast" name="select_breakfast">
                {% for meal in meals[0] %}
                <option value="{{meal.Calories}}">{{meal.Name}} - {{meal.Calories}} Kcal</option>
                <!-- <option value="Mild weight loss">Mild weight loss (0.25 kg/week)</option>
                <option value="Moderate weight loss">Moderate weight loss (0.5 kg/week)</option>
                <option value="Extreme weight loss">Extreme weight loss (1 kg/week)</option> -->
                {% endfor %}
            </select>
      
        </div>
        
        <div class="col">

          <h4>Select Lunch: </h4>
            <select class = "form-select" id="select_lunch" name="select_breakfast">
                {% for meal in meals[1] %}
                <option value="{{meal.Calories}}">{{meal.Name}} - {{meal.Calories}} Kcal</option>
                <!-- <option value="Mild weight loss">Mild weight loss (0.25 kg/week)</option>
                <option value="Moderate weight loss">Moderate weight loss (0.5 kg/week)</option>
                <option value="Extreme weight loss">Extreme weight loss (1 kg/week)</option> -->
                {% endfor %}
            </select>
          
        </div>

        <div class="col">
          
          <h4>Select Dinner: </h4>
            <select class = "form-select" id="select_dinner" name="select_breakfast">
                {% for meal in meals[2] %}
                <option value="{{meal.Calories}}">{{meal.Name}} - {{meal.Calories}} Kcal</option>
                <!-- <option value="Mild weight loss">Mild weight loss (0.25 kg/week)</option>
                <option value="Moderate weight loss">Moderate weight loss (0.5 kg/week)</option>
                <option value="Extreme weight loss">Extreme weight loss (1 kg/week)</option> -->
                {% endfor %}
            </select>
          
      </div>

    </div>
    </div>

    <br>

    <h3>Total calories in Recipe vs Your Daily required calories..</h3>
    <br>
    <div>
      <canvas id="myChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const ctx = document.getElementById('myChart');
      var adjust_according_to_plan = document.getElementById('adjust_according_to_plan').innerText;
      var weight_loss_plan = document.getElementById('weight_loss_plan').innerText;
      var daily_caloric_need = document.getElementById('daily_caloric_need').innerText;


        // Regular expressions to extract the dynamic values
      const caloricNeedMatch = adjust_according_to_plan.match(/(\d+(\.\d+)?)/);  // Matches the number (e.g., 1860.0)
      const weightLossPlanMatch = weight_loss_plan.match(/: (.*)$/);  // Matches the text after the colon
      const dailyCaloricNeedMatch = daily_caloric_need.match(/(\d+(\.\d+)?)/); 


      const value1 = document.getElementById('select_breakfast').value;
      const value2 = document.getElementById('select_lunch').value;
      const value3 = document.getElementById('select_dinner').value;

      const selected_calories = parseFloat(value1) + parseFloat(value2) + parseFloat(value3)

      const myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Calories You Selected', 'Your Daily Caloric Need'],
          datasets: [{
            data: [selected_calories, parseFloat(dailyCaloricNeedMatch[0])],
            borderWidth: 1,
            backgroundColor: ['red', 'blue']
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          },
          plugins: {
        legend: {
          display: false // This hides the legend if there are no labels needed
        }
      }
        }
      });

      // Step 2: Function to update the chart
    function updateChart() {
    // Capture new values from the select tags
    const value1 = document.getElementById('select_breakfast').value;
    const value2 = document.getElementById('select_lunch').value;
    const value3 = document.getElementById('select_dinner').value;

    const selected_calories = parseFloat(value1) + parseFloat(value2) + parseFloat(value3)

    // Update the data in the chart
    myChart.data.datasets[0].data[0] = selected_calories;
    myChart.update();
  }

   // Step 3: Add event listeners to the select tags
    document.getElementById('select_breakfast').addEventListener('change', updateChart);
    document.getElementById('select_lunch').addEventListener('change', updateChart);
    document.getElementById('select_dinner').addEventListener('change', updateChart);


      function resize() {
            myChart.resize(800, 500);
        }
        resize();

    </script>


</body>
</html>
